# Phase 8 â€” Identity & Profiles (Account Linking, Email/Phone Change, Risk Engine) / spec.md

## Goal
Complete the identity surface:
1) **Account linking**: connect/disconnect OAuth providers (Google/Microsoft/Apple*), reuse Phase4 oauth adapter.
2) **Email change** with verify-before-swap; **phone add/verify** with SMS OTP.
3) **Risk engine**: login anomaly detection (new geo, UA family change, velocity), **step-up** challenges and session flags.
4) **Contact discovery (opt-in)**: hashed email/phone matching (privacy-safe).

* Apple SSO optional behind flag.

## 0) Directory (adds)
...existing code...
## 1) Data Model (PostgreSQL 16)
...existing code...
## 2) Redis
...existing code...
## 3) Account Linking (linking.py)
...existing code...
## 4) Email Change (email_change.py)
...existing code...
## 5) Phone Add/Verify (phone_verify.py, sms.py)
...existing code...
## 6) Risk Engine (risk.py)
...existing code...
## 7) Contact Discovery (hashmatch.py)
...existing code...
## 8) REST API (FastAPI)
...existing code...
## 9) Validation & Limits (policy)
...existing code...
## 10) Observability
...existing code...
## 11) Frontend Flows
...existing code...
## 12) Constants
...existing code...
